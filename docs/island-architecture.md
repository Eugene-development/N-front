# –û—Å—Ç—Ä–æ–≤–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (Island Architecture)

## –ß—Ç–æ —ç—Ç–æ?

–û—Å—Ç—Ä–æ–≤–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ ‚Äî –ø–æ–¥—Ö–æ–¥, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ HTML —Å –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º–∏ "–æ—Å—Ç—Ä–æ–≤–∞–º–∏". –ö–∞–∂–¥—ã–π –æ—Å—Ç—Ä–æ–≤ –≥–∏–¥—Ä–∞—Ç–∏—Ä—É–µ—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ, —á—Ç–æ –¥–∞—ë—Ç:

- –ë—ã—Å—Ç—Ä—É—é –Ω–∞—á–∞–ª—å–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É (–º–∏–Ω–∏–º—É–º JS)
- –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–ª–µ–≥—á–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å)
- –õ—É—á—à–∏–π SEO (–∫–æ–Ω—Ç–µ–Ω—Ç —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫

```
src/lib/
‚îú‚îÄ‚îÄ islands/      # –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (*Island.svelte)
‚îú‚îÄ‚îÄ components/   # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–±–µ–∑ JS)
‚îú‚îÄ‚îÄ stores/       # Svelte stores –¥–ª—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ –º–µ–∂–¥—É –æ—Å—Ç—Ä–æ–≤–∞–º–∏
‚îî‚îÄ‚îÄ utils/        # –£—Ç–∏–ª–∏—Ç—ã
```

## –ö–æ–≥–¥–∞ —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ—Å—Ç—Ä–æ–≤?

**–û—Å—Ç—Ä–æ–≤ –Ω—É–∂–µ–Ω –µ—Å–ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç:**
- –†–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∫–ª–∏–∫–∏, –≤–≤–æ–¥)
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏
- –ò–º–µ–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –±—Ä–∞—É–∑–µ—Ä–Ω—ã–µ API

**–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –µ—Å–ª–∏:**
- –¢–æ–ª—å–∫–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- –ö–æ–Ω—Ç–µ–Ω—Ç –∏–∑–≤–µ—Å—Ç–µ–Ω –Ω–∞ —ç—Ç–∞–ø–µ SSR

## –ü—Ä–∏–º–µ—Ä—ã

### –û—Å—Ç—Ä–æ–≤ (–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π)

```svelte
<!-- src/lib/islands/SearchIsland.svelte -->
<script>
  let query = '';
  let results = [];
  
  async function search() {
    const res = await fetch(`/api/search?q=${query}`);
    results = await res.json();
  }
</script>

<input bind:value={query} on:input={search} placeholder="–ü–æ–∏—Å–∫..." />
{#each results as item}
  <div>{item.title}</div>
{/each}
```

### –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç

```svelte
<!-- src/lib/components/Card.svelte -->
<script>
  export let title;
  export let image;
  export let price;
</script>

<article>
  <img src={image} alt={title} />
  <h3>{title}</h3>
  <span>{price} ‚ÇΩ</span>
</article>
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ

```svelte
<!-- src/routes/catalog/+page.svelte -->
<script>
  import SearchIsland from '$lib/islands/SearchIsland.svelte';
  import Card from '$lib/components/Card.svelte';
  
  export let data; // –∏–∑ +page.server.js
</script>

<h1>–ö–∞—Ç–∞–ª–æ–≥</h1>

<!-- –û—Å—Ç—Ä–æ–≤ —Å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é -->
<SearchIsland />

<!-- –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
<div class="grid">
  {#each data.items as item}
    <Card {...item} />
  {/each}
</div>
```

## –ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è –º–µ–∂–¥—É –æ—Å—Ç—Ä–æ–≤–∞–º–∏

–û—Å—Ç—Ä–æ–≤–∞ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã. –î–ª—è –æ–±–º–µ–Ω–∞ –¥–∞–Ω–Ω—ã–º–∏ –∏—Å–ø–æ–ª—å–∑—É–π:

1. **URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã** ‚Äî –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è, –∫–æ—Ç–æ—Ä–æ–µ –¥–æ–ª–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
2. **–†—É–Ω—ã Svelte 5** ‚Äî –¥–ª—è —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
3. **Custom Events** ‚Äî –¥–ª—è —Å–æ–±—ã—Ç–∏–π–Ω–æ–π –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏
4. **runed PersistedState** ‚Äî –¥–ª—è –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (localStorage)

```js
// src/lib/stores/filters.svelte.js
// –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä—É–Ω—ã Svelte 5 –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

// –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –æ–±—ä–µ–∫—Ç —Å $state ‚Äî —Å–≤–æ–π—Å—Ç–≤–∞ –æ–±—ä–µ–∫—Ç–∞ —Ä–µ–∞–∫—Ç–∏–≤–Ω—ã
export const filters = $state({
  active: {},
  sortBy: null
});

export function setFilter(key, value) {
  filters.active[key] = value;
}

export function clearFilters() {
  filters.active = {};
  filters.sortBy = null;
}
```

```svelte
<!-- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –æ—Å—Ç—Ä–æ–≤–µ -->
<script>
  import { filters, setFilter } from '$lib/stores/filters.svelte.js';
</script>

<button onclick={() => setFilter('price', 'asc')}>
  –ü–æ —Ü–µ–Ω–µ
</button>

<p>–ê–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã: {JSON.stringify(filters.active)}</p>
```

### –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (runed)

–î–ª—è –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏, –∏—Å–ø–æ–ª—å–∑—É–π `PersistedState` –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ `runed`:

```js
// src/lib/stores/favorites.svelte.js
import { PersistedState } from 'runed';

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ localStorage
// –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏
export const favorites = new PersistedState('favorites', []);

export function addFavorite(id) {
  favorites.current = [...favorites.current, id];
}

export function removeFavorite(id) {
  favorites.current = favorites.current.filter(item => item !== id);
}

export function isFavorite(id) {
  return favorites.current.includes(id);
}
```

```svelte
<!-- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –æ—Å—Ç—Ä–æ–≤–µ -->
<script>
  import { favorites, addFavorite, removeFavorite, isFavorite } from '$lib/stores/favorites.svelte.js';
  
  let { itemId } = $props();
</script>

<button onclick={() => isFavorite(itemId) ? removeFavorite(itemId) : addFavorite(itemId)}>
  {isFavorite(itemId) ? '‚ù§Ô∏è' : 'ü§ç'}
</button>

<p>–í—Å–µ–≥–æ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–º: {favorites.current.length}</p>
```

–û–ø—Ü–∏–∏ `PersistedState`:
- `storage: 'local' | 'session'` ‚Äî —Ç–∏–ø —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `'local'`)
- `syncTabs: boolean` ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `true`)

### Snapshots (—Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏)

SvelteKit Snapshots —Å–æ—Ö—Ä–∞–Ω—è—é—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –Ω–∞–∑–∞–¥/–≤–ø–µ—Ä—ë–¥. –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è —Ñ–æ—Ä–º, —Å–∫—Ä–æ–ª–ª–∞, –æ—Ç–∫—Ä—ã—Ç—ã—Ö –∞–∫–∫–æ—Ä–¥–µ–æ–Ω–æ–≤ –∏ —Ç.–¥.

```svelte
<!-- src/routes/catalog/+page.svelte -->
<script>
  let searchQuery = $state('');
  let scrollPosition = $state(0);

  /** @type {import('./$types').Snapshot<{ query: string, scroll: number }>} */
  export const snapshot = {
    capture: () => ({
      query: searchQuery,
      scroll: scrollPosition
    }),
    restore: (value) => {
      searchQuery = value.query;
      scrollPosition = value.scroll;
    }
  };
</script>

<input bind:value={searchQuery} placeholder="–ü–æ–∏—Å–∫..." />
```

–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Snapshots:
- –í–≤–µ–¥—ë–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –≤ –ø–æ–ª—è –ø–æ–∏—Å–∫–∞/—Ñ–∏–ª—å—Ç—Ä–æ–≤
- –ü–æ–∑–∏—Ü–∏—è —Å–∫—Ä–æ–ª–ª–∞ –≤ —Å–ø–∏—Å–∫–∞—Ö
- –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–∞—Å–∫—Ä—ã—Ç—ã—Ö/—Å–≤—ë—Ä–Ω—É—Ç—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- –í—ã–±—Ä–∞–Ω–Ω—ã–µ —Ç–∞–±—ã

–í–∞–∂–Ω–æ: –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å JSON-—Å–µ—Ä–∏–∞–ª–∏–∑—É–µ–º—ã–º–∏.

## –†–∞–±–æ—Ç–∞ —Å GraphQL

–ò—Å–ø–æ–ª—å–∑—É–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É `graphql-request` –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API.

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞

```js
// src/lib/api/client.js
import { GraphQLClient } from 'graphql-request';
import { PUBLIC_API_URL } from '$env/static/public';

export const client = new GraphQLClient(`${PUBLIC_API_URL}/graphql`, {
  headers: {
    // –ó–∞–≥–æ–ª–æ–≤–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  }
});

// –ö–ª–∏–µ–Ω—Ç —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
export function getAuthClient(token) {
  return new GraphQLClient(`${PUBLIC_API_URL}/graphql`, {
    headers: {
      Authorization: `Bearer ${token}`
    }
  });
}
```

### –ó–∞–ø—Ä–æ—Å—ã –≤ –æ—Å—Ç—Ä–æ–≤–∞—Ö

```svelte
<!-- src/lib/islands/CatalogIsland.svelte -->
<script>
  import { client } from '$lib/api/client.js';
  import { gql } from 'graphql-request';
  
  let items = $state([]);
  let loading = $state(false);
  
  const GET_ITEMS = gql`
    query GetItems($limit: Int, $offset: Int) {
      items(limit: $limit, offset: $offset) {
        id
        title
        price
        image
      }
    }
  `;
  
  async function loadItems() {
    loading = true;
    try {
      const data = await client.request(GET_ITEMS, { limit: 20, offset: 0 });
      items = data.items;
    } finally {
      loading = false;
    }
  }
  
  $effect(() => {
    loadItems();
  });
</script>
```

### –ó–∞–ø—Ä–æ—Å—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (SSR)

```js
// src/routes/catalog/+page.server.js
import { client } from '$lib/api/client.js';
import { gql } from 'graphql-request';

const GET_CATALOG = gql`
  query GetCatalog {
    catalog {
      id
      title
      price
    }
  }
`;

export async function load() {
  const data = await client.request(GET_CATALOG);
  return { items: data.catalog };
}
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ GraphQL —Ñ–∞–π–ª–æ–≤

```
src/lib/
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ client.js         # GraphQL –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îî‚îÄ‚îÄ queries/          # GraphQL –∑–∞–ø—Ä–æ—Å—ã
‚îÇ       ‚îú‚îÄ‚îÄ catalog.js
‚îÇ       ‚îú‚îÄ‚îÄ auth.js
‚îÇ       ‚îî‚îÄ‚îÄ user.js
```

### –ú—É—Ç–∞—Ü–∏–∏

```js
// src/lib/api/queries/auth.js
import { gql } from 'graphql-request';

export const LOGIN = gql`
  mutation Login($email: String!, $password: String!) {
    login(email: $email, password: $password) {
      token
      user {
        id
        name
        email
      }
    }
  }
`;
```

```svelte
<!-- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –æ—Å—Ç—Ä–æ–≤–µ -->
<script>
  import { client } from '$lib/api/client.js';
  import { LOGIN } from '$lib/api/queries/auth.js';
  
  let email = $state('');
  let password = $state('');
  
  async function handleLogin() {
    const data = await client.request(LOGIN, { email, password });
    // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–∫–µ–Ω...
  }
</script>
```

## –ß–µ–∫–ª–∏—Å—Ç

- [ ] –ò–º—è —Ñ–∞–π–ª–∞ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ `Island.svelte`
- [ ] –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –≤ –ø–∞–ø–∫–µ `src/lib/islands/`
- [ ] –ù–µ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –¥—Ä—É–≥–∏–µ –æ—Å—Ç—Ä–æ–≤–∞ –Ω–∞–ø—Ä—è–º—É—é
- [ ] –†–∞–∑–º–µ—Ä –±–∞–Ω–¥–ª–∞ < 50KB gzip
- [ ] –ï—Å—Ç—å fallback –¥–ª—è SSR (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω)
